FROM ubuntu:22.04
RUN apt-get update && apt-get -y upgrade && apt-get -y install language-pack-ja

ENV TZ=Asia/Tokyo
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
ENV PYTHONIOENCODING=utf-8
ENV LC_ALL='ja_JP.UTF-8'
ENV LANG='ja_JP.UTF-8'

RUN mkdir /app
WORKDIR /app

COPY ./app/requirements.txt /app
RUN apt-get -y install pkg-config libz-dev libpcre3 libpcre3-dev python3-pip python3-venv

COPY ./app /app
EXPOSE 9000

ARG UID=1000
RUN useradd -u ${UID} -m app && chown -R app:app /app
USER app

RUN python3 -m venv /app/.venv && . /app/.venv/bin/activate && pip install -r requirements.txt

CMD ["/app/.venv/bin/uwsgi", "uwsgi.ini"]
